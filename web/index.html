<!DOCTYPE html>
<html>

<head>
  <base href="$FLUTTER_BASE_HREF" />

  <meta charset="UTF-8" />
  <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
  <meta name="description" content="A new Flutter project." />

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="flutter_web_loading_tips" />
  <link rel="apple-touch-icon" href="icons/Icon-192.png" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <title>Flutter Web Loading Tips</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />

  <script>
        const serviceWorkerVersion = null; // The value below is injected by flutter build, do not touch.

        function increaseProgress(targetPercentage, currentPercentage) {
            return new Promise((resolve) => {
                const interval = setInterval(() => {
                    if (currentPercentage >= targetPercentage) {
                        clearInterval(interval);
                        resolve();
                    } else {
                        currentPercentage++;
                        progress.style.width = `${currentPercentage}%`;
                    }
                }, 15);
            });
        }
    </script>
  <!-- This script adds the flutter initialization JS code -->
  <script src="flutter.js" defer></script>
</head>

<body>
<!-- Create a progress bar container with a nested progress bar and loading text -->
<div class="progress-container" id="progressbar">
  <div class="progress-bar" id="progress"></div>
</div>
<p id="loadingText">Loading app...</p>
<script>
        const progress = document.getElementById("progress");
        const progressBar = document.getElementById("progressbar");
        const loadingText = document.getElementById("loadingText");

        progress.style.width = `0%`;

        window.addEventListener("load", async function (ev) {
            await increaseProgress(33, 0);

            _flutter.loader.loadEntrypoint({
                serviceWorker: {
                    serviceWorkerVersion: serviceWorkerVersion,
                },
                onEntrypointLoaded: async function (engineInitializer) {
                    loadingText.innerText = "Almost there!";
                    await increaseProgress(66, 33);

                    const appRunner = await engineInitializer.initializeEngine();

                    await increaseProgress(99, 66);

                    progressBar.style.opacity = 0;
                    loadingText.style.opacity = 0;

                    await appRunner.runApp();

                    document.querySelector("flutter-view").classList.add("fade-in");
                },
            });
        });
    </script>
</body>

</html>
